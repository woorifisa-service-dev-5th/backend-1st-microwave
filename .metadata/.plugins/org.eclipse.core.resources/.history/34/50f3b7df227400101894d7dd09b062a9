package dev.syntax.thread;

import java.util.Scanner;

import dev.syntax.model.Microwave;

public class User implements Runnable {
	private int userNum;
	private Microwave microwave;
	private Scanner scanner;
//    Timer timer = new Timer(microwave);
//    HeatTask heat = new HeatTask(microwave);
//    microwave.addListener(heat);
//    microwave.addListener(timer);
//    Thread timerThread = new Thread(timer);
//    Thread heatThread = new Thread(heat);
	public User(int userNum, Microwave microwave) {
		this.userNum = userNum;
		this.microwave = microwave;
		this.scanner = new Scanner(System.in);
	}

	@Override
	public void run() {
		while (true) {
			showMenu();
			int input = Integer.parseInt(scanner.nextLine());
			handleInput(input);
		}
	}

	private void showMenu() {
		System.out.println("\n[User #" + userNum + "| ì „ìë ˆì¸ì§€ ì¡°ì‘]");
		System.out.println("1. ë¬¸ ì—´ê¸°");
		System.out.println("2. ë¬¸ ë‹«ê¸°");
		System.out.println("3. ì‘ë™ ì‹œì‘");
		System.out.println("4. ì¼ì‹œ ì •ì§€");
		System.out.println("5. ë‚¨ì€ ì‹œê°„");
		System.out.println("6. ì¢…ë£Œ");
		System.out.print("ì„ íƒ > ");
	}

	private void handleInput(int input) {
		switch (input) {
		case 1 -> { // ë¬¸ ì—´ê¸° ìš”ì²­

			if (microwave.getIsOpened())
				System.out.println("ğŸš¨ë¬¸ì´ ì´ë¯¸ ì—´ë ¤ ìˆìŠµë‹ˆë‹¤.");
			else {
				microwave.setDoorOpened();
				System.out.println("ë¬¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.");
			}
		}
		case 2 -> { // ë¬¸ ë‹«ê¸° ìš”ì²­

			if (!microwave.getIsOpened())
				System.out.println("ë¬¸ì´ ì´ë¯¸ ë‹«í˜€ ìˆìŠµë‹ˆë‹¤.");
			else {
				microwave.setDoorClosed();
				System.out.println("ë¬¸ì„ ë‹«ì•˜ìŠµë‹ˆë‹¤.");
			}
		}
		case 3 -> {

			if (microwave.getIsOpened()) {
				System.out.println("ë¬¸ì„ ë‹«ì•„ì£¼ì„¸ìš”.");
			}else if(microwave.getTime()>0&&!microwave.getIsRunning()){
				microwave.turnOn();
				System.out.println("ì´ì–´ì„œ ë™ì‘");
			}
			else {
				System.out.print("ì‘ë™í•  ì‹œê°„(ì´ˆ)ì„ ì…ë ¥í•˜ì„¸ìš” > ");
				int seconds = Integer.parseInt(scanner.nextLine());

				// ì „ìë ˆì¸ì§€ì— ì‹œê°„ ì„¤ì •
				microwave.setTime(seconds);

				microwave.turnOn();
			}
		}
		case 4 -> { // ì‘ë™ ë©ˆì¶”ê¸° ìš”ì²­

			if (!microwave.getIsRunning())
				System.out.println("ì´ë¯¸ ì •ì§€ ìƒíƒœì…ë‹ˆë‹¤.");
			else
				microwave.turnOff();
			System.out.println("ì¼ì‹œì •ì§€!!");
		}
		case 5 -> { // ì‹œê°„ í™•ì¸ ìš”ì²­

			if (!microwave.getIsRunning())
				System.out.println("ì •ì§€ ìƒíƒœì…ë‹ˆë‹¤.");
			else
				System.out.println(microwave.getTime() + "ì´ˆ ë‚¨ìŒ..");
		}

		case 6 -> { // ì¢…ë£Œ ìš”ì²­
			System.out.println("[LOG][User " + userNum + "] ì¢…ë£Œ ìš”ì²­ â†’ ì“°ë ˆë“œ ì¢…ë£Œ");
			System.out.println("");
			System.exit(0); // ì´ê±´ ì „ì²´ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
		}
		default -> System.out.println("[LOG][User " + userNum + "] ì˜ëª»ëœ ì…ë ¥: " + input);
		}
	}

}
